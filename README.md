### 概要

`duwallet` は複数ユーザーが共同で管理する家計簿を、収入割合や残金に応じた独自ロジックで自動割勘し、決済期限も含めて一元管理できる PWA です。主目的は夫婦 2 名での利用ですが、ユーザー数拡張やチーム利用を想定したスケーラビリティも確保します。アプリ名は _duet / duo_ + _wallet_ に由来します。日本語のみ対応。

### レイアウト・デザイン

白黒グレー基本にアクセントカラーとして1、2、3色程入れ、シンプルの中にもリッチで美しく、UI/UXの高いデザインを目指す。データ読み込み中はスケルトンなどを使用する。

### 基本設計

#### アプリ起動時の画面遷移ロジック

アプリ起動時、以下の条件に基づいて自動的に適切な画面に遷移します：

1. ログイン済みでない場合：
   - タイトル画面（S-01）を表示
   
2. ログイン済みで、参加中の家計簿がない場合：
   - 家計簿選択画面（S-03）に遷移
   
3. ログイン済みで、参加中の家計簿があり、複数家計簿に参加する設定の場合：
   - 家計簿選択画面（S-03）に遷移
   
4. ログイン済みで、参加中の家計簿があり、一つの家計簿のみに参加する設定の場合：
   - 家計簿ホーム画面（S-05）に直接遷移

#### タイトル画面：アプリ名表示、ログイン、ユーザー登録

ログイン：
Eメール、パスワード、MFA（端末の顔認証か指紋認証）
ログイン→自動遷移ロジックに基づいて適切な画面へ
ユーザー登録：
ユーザー登録をクリック→ユーザー登録画面

#### ユーザー登録画面：ユーザー情報入力、登録

ユーザー情報項目：
Eメール、パスワード、名前、性別、複数家計簿に参加するか一つの家計簿のみ参加するかの選択
登録：
登録をクリック→家計簿選択画面

#### 家計簿選択画面：家計簿選択、家計簿作成、家計簿参加申請（参加コード入力）、ユーザー設定

※ログインユーザーが家計簿に1つも参加していない、または、複数家計簿に参加するを選んでいる場合のみ表示し、それ以外はスキップ
家計簿選択：
表示されている家計簿名をクリック→家計簿ホーム画面
家計簿作成：
家計簿作成をクリック→家計簿作成画面
家計簿参加申請：
参加コード入力→参加申請クリック→申請中の家計簿：◯件と表示→参加承認待機
ユーザー設定：
ユーザー設定ボタンをクリック→ユーザー設定画面

#### 家計簿作成画面：基本設定項目入力、作成

基本設定項目：
家計簿名、家計簿参加申請を受信する/しないの選択、参加コード（自動発行か入力）
作成：
作成クリック→管理ユーザーロール付与→家計簿ホーム画面

#### 家計簿ホーム画面：表示項目の表示、月移動、メニュー表示

※ 作成する月次収支情報は今月＋1ヶ月先までデフォルトで作成しておく。月が変わる時に更に次月の収入情報を作成する。過去の収支情報も削除しない。
認証：
この画面以降の画面はログインしているかつ家計簿に参加済みであることの認証が必要
表示項目：
現在の年月、参加ユーザー名、ユーザー別月次収入合計、ユーザー別月次支出合計、ユーザー共通月次収入合計、ユーザー共通月次支出合計、全ユーザー月次収入合計、全ユーザー月次支出合計、ユーザー別月次支払額（支払先に支払日までに支払わなければならない金額、算出方法に依存）、全ユーザー月次支払額合計（支払先に支払日までに支払わなければならない金額、算出方法に依存）、全体に対するユーザー別支払率（全員で100%、算出方法に依存）、月次の支払先毎の支払期限
月移動：
前月、次月をクリックで表示月を更新
メニュー：
ハンバーガーメニューをクリックでサイドバーを表示し、各機能へアクセス
- 収支登録：収支登録クリック→月次収支登録画面
- 支払先登録：支払先をクリック→支払先登録画面
- 支払額算出設定：支払額算出クリック→支払額算出設定画面
- 基本設定編集：基本設定クリック→家計簿基本設定画面
- 参加ユーザー管理：参加ユーザークリック→参加ユーザー管理画面
- ユーザー設定：ユーザー設定クリック→ユーザー設定画面

#### 月次収支登録画面：入力項目の入力、登録、編集、削除

認証：
ログインしているかつ家計簿に参加済みであることの認証が必要
表示項目：
ユーザー別登録済み収支一覧、ユーザー共通登録済み収支一覧
入力項目：
収支日付、ユーザー別月次収入、ユーザー別月次支出、次月以降も自動追加するかの設定、ユーザー共通月次収入、ユーザー共通月次支出
編集・削除：
登録済み収支の編集・削除機能
登録：
登録をクリック→家計簿ホーム画面

#### 支払先登録画面：支払先情報入力、登録

支払先情報：
名称、月次支払日（4日、27日、月末最終日など）
登録：
登録をクリック→家計簿ホーム画面

#### 支払額算出設定画面：算出方法選択、ユーザー別支払額表示、ユーザー別支払率表示、支払率編集、切上げ桁編集、収入参照月選択

認証：
ログインしているかつ家計簿に参加済みであることの認証が必要
算出方法：
収入割合方式：
全ユーザー月次支払額合計×ユーザーの収入率
ユーザーの収入率：
ユーザー別月次収入合計÷(全ユーザー月次収入合計-ユーザー共通月次収入合計)
残金均一方式：
ユーザー別月次収入合計-((全ユーザー月次収入合計-全ユーザー月次支出合計)÷参加ユーザー数)
ユーザー別支払額表示：
選択した算出方法で算出したユーザーごとの月次支払額を表示
ユーザー別支払率表示：
算出方法：収入割合方式選択時
ユーザーの収入率
算出方法：残金均一方式選択時
ユーザー別月次支払額÷全ユーザー月次支払額合計
支払率編集：
算出方法から算出した支払率をベースの支払率とし、そのベースのユーザー別支払率から(参加ユーザー数-1)%ずつ増減を設定できる
※1人を(参加ユーザー数-1)%増加させた場合、他のユーザーの支払率を1%減少させる（減少させた場合も同様）
切上げ桁編集：
支払額の下何桁から切上げるかを数値で指定できる（デフォルト下1桁）

収入参照月選択：前月/今月
前月が存在しない場合、前月を選べない

#### 基本設定編集画面：基本設定項目入力、登録

基本設定項目：
家計簿名、家計簿参加申請を受信する/しないの選択、参加コード（自動発行か入力）
登録：
登録クリック→家計簿ホーム画面

#### 参加ユーザー管理画面：参加ユーザーの表示、申請ユーザーの表示、参加ユーザーのロール選択、申請ユーザーの承認/却下

参加ユーザーの表示：
参加ユーザーの名前、Eメール、ロールの表示
参加ユーザーのロール選択：
ロール：
管理ユーザー、一般ユーザー
管理ユーザー権限：
家計簿に申請したユーザーの参加の承認/却下
申請ユーザーの表示：
申請ユーザーの名前、Eメール、承認ボタン、却下ボタン
※承認/却下ボタンは管理ユーザーにのみ表示
申請ユーザーの承認/却下：
承認：
承認ボタン→参加承認待機の解除→一般ユーザーロール付与→家計簿選択に家計簿名を表示
却下：
却下ボタン→参加承認待機の解除

#### ユーザー設定画面：ユーザー情報編集、遷移元への戻り

認証：
ログインしていることの認証が必要
ユーザー情報項目：
Eメール、パスワード、名前、性別、複数家計簿に参加するか一つの家計簿のみに参加するかの選択
※ 既に複数の家計簿に参加している場合、「一つの家計簿のみに参加する」オプションは選択できない（無効化される）。この場合は、他の家計簿から退会して参加家計簿が1つだけになってから設定を変更する必要がある。
保存：
保存をクリック→遷移元画面に戻る（家計簿ホーム画面または家計簿選択画面）
