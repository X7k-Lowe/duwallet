# duwalletのディレクトリ構成

## 基本ディレクトリ構成

```
duwallet/
├── app/                       # Next.js App Router ディレクトリ
│   ├── (auth)/                # 認証関連のルート（グループ化）
│   │   ├── login/             # S-01_title.yamlのログイン機能
│   │   ├── register/          # S-02_user_register.yaml
│   │   └── layout.tsx         # 認証ページ共通レイアウト
│   ├── (wallet)/              # 家計簿関連のルート
│   │   ├── select/            # S-03_wallet_select.yaml
│   │   ├── create/            # S-04_wallet_create.yaml
│   │   ├── expenses/          # S-06_monthly_income_expense.yaml
│   │   ├── payments/          # S-07_payment_destination.yaml
│   │   ├── calculations/      # S-08_calculation_settings.yaml
│   │   ├── settings/          # S-09_basic_settings.yaml
│   │   ├── members/           # S-10_member_management.yaml
│   │   ├── layout.tsx         # 家計簿共通レイアウト
│   │   └── page.tsx           # S-05_wallet_home.yaml
│   ├── (user)/                # ユーザー関連のルート
│   │   ├── settings/          # S-11_user_settings.yaml
│   │   └── layout.tsx         # ユーザー設定共通レイアウト
│   ├── api/                   # API ルート（必要に応じて）
│   ├── globals.css            # グローバルスタイル
│   ├── layout.tsx             # ルートレイアウト
│   └── page.tsx               # トップページ
├── public/                    # 静的アセット
│   ├── favicon.ico            # ファビコン
│   ├── logo.svg               # アプリロゴ
│   ├── manifest.json          # PWAマニフェスト
│   └── icons/                 # アプリアイコン（各サイズ）
├── lib/                       # 共通ロジック・Supabaseクライアント
│   ├── supabase/              # Supabase関連
│   │   ├── client.ts          # クライアントインスタンス
│   │   ├── server.ts          # サーバーサイドクライアント
│   │   └── types.ts           # Supabaseテーブル型定義
│   ├── utils/                 # ユーティリティ関数
│   │   ├── date.ts            # 日付操作関数
│   │   ├── money.ts           # 金額計算関数（big.js使用）
│   │   └── validation.ts      # バリデーション関数
│   └── auth/                  # 認証ヘルパー
├── components/                # 再利用可能なUIコンポーネント
│   ├── ui/                    # 基本UIコンポーネント（shadcn/ui）- Server Components
│   │   ├── button.tsx         # ボタンコンポーネント
│   │   ├── dialog.tsx         # ダイアログコンポーネント
│   │   └── ...                # その他のshadcn/uiコンポーネント
│   ├── client/                # 明示的にクライアント側で動作するコンポーネント
│   │   ├── forms/             # インタラクティブなフォーム
│   │   │   ├── income-expense-form.tsx # 収支登録フォーム
│   │   │   ├── payment-form.tsx        # 支払先登録フォーム
│   │   │   ├── calculation-form.tsx    # 計算設定フォーム
│   │   │   └── wallet-form.tsx         # 家計簿作成/編集フォーム
│   │   ├── interactive/       # その他のインタラクティブなUI
│   │   │   ├── date-picker.tsx
│   │   │   └── amount-input.tsx
│   │   └── providers/         # コンテキストプロバイダー
│   │       └── theme-provider.tsx
│   ├── layouts/               # レイアウトコンポーネント - 基本Server Components
│   │   ├── header.tsx         # ヘッダーコンポーネント
│   │   ├── sidebar.tsx        # サイドバーコンポーネント
│   │   └── footer.tsx         # フッターコンポーネント
│   └── dashboard/             # ダッシュボード用コンポーネント - 基本Server Components
│       ├── expense-card.tsx   # 支出カードコンポーネント
│       ├── summary-chart.tsx  # 集計チャートコンポーネント
│       └── balance-display.tsx# 残高表示コンポーネント
├── hooks/                     # React hooks
│   ├── use-auth.ts            # 認証状態管理フック
│   ├── use-form.ts            # フォーム操作カスタムフック
│   ├── use-wallets.ts         # 家計簿データ取得・操作フック
│   ├── use-income-expenses.ts # 収支データ取得・操作フック
│   ├── use-payments.ts        # 支払先データ取得・操作フック
│   ├── use-calculations.ts    # 計算設定データ取得・操作フック
│   └── use-members.ts         # メンバー管理データ取得・操作フック
├── styles/                    # スタイル関連ファイル
│   └── theme.ts               # テーマ設定（カラーパレットなど）
├── stores/                    # Zustand ストア（複数形）
│   ├── auth-store.ts          # 認証状態ストア
│   ├── wallet-store.ts        # 家計簿データストア
│   ├── income-expense-store.ts # 収支データストア
│   ├── calculation-store.ts   # 計算設定ストア
│   └── ui-store.ts            # UI状態管理ストア
├── types/                     # 型定義ファイル
│   ├── user.ts                # ユーザープロフィール情報 (public.users) の型定義 (D-01_users の public.users スキーマに対応)
│   ├── wallet.ts              # 家計簿情報の型定義 (D-02_wallets)
│   ├── wallet-member.ts       # 家計簿メンバーの型定義 (D-03_wallet_members)
│   ├── join-request.ts        # 参加リクエストの型定義 (D-04_wallet_join_requests)
│   ├── income-expense.ts      # 収支情報の型定義 (D-05_income_expenses)
│   ├── payment-destination.ts # 支払先情報の型定義 (D-06_payment_destinations)
│   ├── calculation.ts         # 計算設定の型定義 (D-07_calculation_settings)
│   └── payment-rate.ts        # 支払率調整の型定義 (D-08_payment_rate_adjustments)
├── middleware.ts              # 認証ミドルウェア
├── docker-compose.dev.yaml    # 開発環境用Docker Compose設定
├── Dockerfile.dev             # 開発環境用Dockerfile
├── next.config.mjs            # Next.js設定ファイル
├── tailwind.config.js         # Tailwind CSS設定
├── postcss.config.js          # PostCSS設定
├── vitest.config.ts           # Vitest設定
├── .eslintrc.json             # ESLint設定
├── .prettierrc                # Prettier設定
├── tsconfig.json              # TypeScript設定
├── pnpm-lock.yaml             # pnpm ロックファイル
└── package.json               # パッケージ定義

```

## 実装のポイント

1. **ディレクトリ構造の原則**:

   - 機能ごとにディレクトリを分割
   - コンポーネントは再利用性を考慮して階層化
   - App Routerのグループ機能（()括弧）を活用したルート整理
   - **アクティブウォレットパターン**を採用（URLからIDを省略）
2. **主要なファイル**:

   - `lib/supabase/client.ts` - フロントエンド用Supabaseクライアント設定
   - `lib/supabase/server.ts` - サーバーサイド用Supabaseクライアント
   - `components/ui/*` - shadcn/uiベースの基本コンポーネント
   - `stores/*.ts` - Zustandを使用した状態管理
3. **開発環境セットアップ**:

   - `docker-compose.dev.yaml`で開発環境を構築
   - ローカルSupabaseインスタンスをDocker経由で起動
   - PostgreSQL、ストレージ、認証機能を一括でセットアップ
4. **PWA対応**:

   - `public/manifest.json`でPWA設定
   - `@ducanh2912/next-pwa`によるService Worker自動生成
   - オフライン対応とインストール機能の実装

## 実装時の注意点

- TypeScriptの型定義を徹底し、型安全性を確保
- コンポーネント設計時はアトミックデザインの原則を考慮
- サーバーコンポーネントとクライアントコンポーネントの適切な使い分け
- 認証状態に基づくルーティング制御の実装
- Server ActionsとSWRを組み合わせた効率的なデータフェッチ
- アクティブウォレットパターンによるURL構造の簡素化
  - Zustandを使用した「現在選択中の家計簿」の状態管理
  - ミドルウェアによる適切な自動遷移処理
  - 家計簿IDをURLに含めず、セキュリティとUXを向上

このディレクトリ構成は、Next.js 14とApp Routerを活用した最新のReactアプリケーション開発のベストプラクティスに基づいています。
