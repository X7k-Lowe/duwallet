# duwalletの技術スタック

## 概要

duwalletは複数ユーザーが共同で管理する家計簿PWAアプリケーションです。本ドキュメントでは、アプリケーションの実装に必要な技術スタックとそのバージョン、選定理由について詳細に記述します。

## 基本方針

- **PWA (Progressive Web App)** として実装
- iPhone/Android両方からアクセス可能
- 低コスト運用（月額$0を目標）
- 十分な機能性と美しいUIを両立
- メンテナンス性の高いコードベース
- 将来のスケーリングに対応

## 技術スタック詳細

### フロントエンド

| 技術                                                                   | バージョン | 用途・選定理由                                                                                                                       |
| ---------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| [Next.js](https://nextjs.org/)                                            | 15.3.2     | Reactベースのフレームワーク。App Routerによる最新ルーティング、Server Components、Turbopack対応。Vercelとの連携で高速なWeb体験を実現 |
| [React](https://react.dev/)                                               | 18.2.0     | UIコンポーネントの構築。Next.jsに含まれる                                                                                            |
| [TypeScript](https://www.typescriptlang.org/)                             | 5.8.3      | 型安全なコード開発により、バグの早期発見とメンテナンス性向上                                                                         |
| [PWA対応](https://developer.mozilla.org/ja/docs/Web/Progressive_web_apps) | -          | ホーム画面に追加可能なアプリライクな体験を提供                                                                                       |
| [@ducanh2912/next-pwa](https://github.com/DuCanhGH/next-pwa)              | 9.1.0      | Next.js 14 & App Router 対応の PWA プラグイン。Service Worker を自動生成しオフライン対応を簡素化                                     |

### UI/デザイン

| 技術                                         | バージョン | 用途・選定理由                                                                                                   |
| -------------------------------------------- | ---------- | ---------------------------------------------------------------------------------------------------------------- |
| [Tailwind CSS](https://tailwindcss.com/)        | 3.4.0      | ユーティリティファーストのCSSフレームワーク。迅速なUI開発とカスタマイズ性の両立                                  |
| [shadcn/ui](https://ui.shadcn.com/)             | 0.5.0      | Radix UIベースの美しいコンポーネント集。低レベルな基本コンポーネントを提供し、高いカスタマイズ性と再利用性を実現 |
| [Radix UI](https://www.radix-ui.com/)           | 1.0.0      | アクセシビリティに優れたヘッドレスUIコンポーネント。shadcn/uiの基盤                                              |
| [Lucide Icons](https://lucide.dev/)             | 0.339.0    | 美しく一貫性のあるアイコンセット                                                                                 |
| [Framer Motion](https://www.framer.com/motion/) | 11.0.0     | モダンで洗練されたアニメーション実装                                                                             |
| class-variance-authority / tailwind-merge    | latest     | Tailwind のクラス競合解決・variant 生成を効率化（shadcn/ui 推奨ユーティリティ）                                  |

### バックエンド

| 技術                                                      | バージョン | 用途・選定理由                                                                                                                                                              |
| --------------------------------------------------------- | ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Supabase](https://supabase.com/)                            | 2.49.4     | オープンソースのFirebase代替。認証、データベース(`@supabase/supabase-js`として利用)、ストレージを統合したバックエンドサービス。**クラウド環境を利用。**無料枠が十分に広い |
| [PostgreSQL](https://www.postgresql.org/)                    | 15.0+      | Supabaseが提供する高機能なリレーショナルデータベース                                                                                                                        |
| [Edge Functions](https://supabase.com/docs/guides/functions) | -          | 必要に応じてサーバーレス関数を実装可能                                                                                                                                      |

### 認証・セキュリティ

| 技術                                                                        | バージョン | 用途・選定理由                                                                                                                                                                                        |
| --------------------------------------------------------------------------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Supabase Auth](https://supabase.com/docs/guides/auth)                         | -          | メールアドレス認証やソーシャルログインの実装。MFA対応も可能。認証情報は `auth.users` テーブルで管理され、アプリケーション固有のユーザープロフィールは `public.users` テーブルと連携して管理する。 |
| [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security) | -          | データベースレベルでの厳格なアクセス制御を実現                                                                                                                                                        |
| [@supabase/ssr](https://supabase.com/docs/guides/auth/server-side-rendering)   | ^0.6.1     | Next.js (App Router)環境でのSSR/RSCにおけるセッション取得やCookie管理を簡素化 (旧Auth Helpers後継)                                                                                                    |

### 状態管理・データフェッチ

| 技術                                                        | バージョン | 用途・選定理由                                                                                                  |
| ----------------------------------------------------------- | ---------- | --------------------------------------------------------------------------------------------------------------- |
| [Zustand](https://zustand-demo.pmnd.rs/)                       | 4.5.0      | 軽量でシンプルなクライアント状態管理ライブラリ。Reduxよりもボイラープレートが少なく、TypeScriptとの親和性が高い |
| [Tanstack Query](https://tanstack.com/query/latest)            | 5.17.0     | サーバー状態管理とデータフェッチの最適化。キャッシュ、再取得、ページネーションなどを効率的に処理                |
| [Supabase Realtime](https://supabase.com/docs/guides/realtime) | -          | リアルタイムデータ同期を実現。複数ユーザーでの同時編集に対応                                                    |

### フォーム処理・バリデーション

| 技術                                         | バージョン | 用途・選定理由                                                                       |
| -------------------------------------------- | ---------- | ------------------------------------------------------------------------------------ |
| [React Hook Form](https://react-hook-form.com/) | 7.50.0     | パフォーマンスに優れたフォーム状態管理。不要な再レンダリングを最小限に抑制           |
| [Zod](https://zod.dev/)                         | 3.22.0     | TypeScriptファーストのスキーマバリデーションライブラリ。型安全なバリデーションを実現 |

### デプロイ・CI/CD

| 技術                                                 | バージョン | 用途・選定理由                                                                        |
| ---------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------- |
| [Vercel](https://vercel.com/)                           | -          | Next.jsアプリケーションの最適なホスティングプラットフォーム。無料枠で十分な運用が可能 |
| [GitHub Actions](https://github.com/features/actions)   | -          | CIパイプラインの自動化。テスト、リント、ビルドを自動実行                              |
| [Supabase CLI](https://supabase.com/docs/reference/cli) | 1.145.0    | Supabaseプロジェクトの管理、マイグレーション、ローカル開発環境の構築                  |

### 開発ツール

| 技術                                                                                 | バージョン | 用途・選定理由                                                                                              |
| ------------------------------------------------------------------------------------ | ---------- | ----------------------------------------------------------------------------------------------------------- |
| [pnpm](https://pnpm.io/)                                                                | 10.11.0    | 高速で効率的なパッケージマネージャー。ディスク容量の節約とインストール速度の向上                            |
| [ESLint](https://eslint.org/)                                                           | 8.56.0     | コード品質の向上とスタイル一貫性の確保                                                                      |
| [Prettier](https://prettier.io/)                                                        | 3.2.0      | コードフォーマッタ。コードスタイルの自動統一                                                                |
| [autoprefixer](https://github.com/postcss/autoprefixer)                                 | 10.4.17    | Tailwind CSS/Next.jsのPostCSSプラグインとして必須。ベンダープレフィックス自動付与                           |
| [Vitest](https://vitest.dev/)                                                           | 3.1.3      | 高速で軽量なテストフレームワーク。Viteベースでセットアップが容易                                            |
| [@testing-library/react](https://testing-library.com/docs/react-testing-library/intro/) | 16.3.0     | ユーザー視点でのReactコンポーネントテストを容易にするライブラリ                                             |
| [Docker / Docker Compose](https://www.docker.com/)                                      | 24.x       | ローカルでのNext.jsアプリケーション開発環境の起動。CI/CD の一貫性確保。**Supabaseはクラウドを利用。** |

### 国際化・日本語対応

### 日付・数値処理

| 技術                                     | バージョン | 用途・選定理由                                                         |
| ---------------------------------------- | ---------- | ---------------------------------------------------------------------- |
| [date-fns](https://date-fns.org/)           | 3.3.0      | 軽量な日付操作ライブラリ。Tree-shakingにより必要な機能のみバンドル可能 |
| [big.js](https://mikemcl.github.io/big.js/) | 6.2.1      | 高精度な金額計算に必要。JavaScript浮動小数点問題を回避                 |

## アプリケーションの構成図

```
duwallet/
├── app/                 # Next.js App Router ディレクトリ
├── public/              # 静的アセット
├── lib/                 # 共通ロジック・Supabase クライアント
├── components/          # 再利用 UI
├── hooks/               # React hooks
├── styles/
├── docker-compose.dev.yaml  # ← docs からコピーして統合運用
├── Dockerfile.dev
├── next.config.mjs
├── tailwind.config.js
└── package.json
```

## PWA対応

PWA対応のために以下を実装します：

1. **Service Worker**: オフライン対応とキャッシュ戦略
2. **マニフェストファイル**: アプリのメタデータ、アイコン、テーマカラーなど
3. **インストール体験**: ホーム画面への追加ガイド
4. **オフライン対応**: 基本機能をオフライン時にも使用可能に
5. **プッシュ通知**: 支払期限が近づいた際の通知（オプション）

## コスト最適化

- **Vercel Hobby**: 無料プラン（月100GB帯域幅、無料のSSL証明書）
- **Supabase Free Tier**: 500MBのデータベース、5GBのストレージ、月あたり200万行のリアルタイム
- **GitHub Free**: 無制限のパブリックリポジトリ、GitHub Actionsの無料枠

## 技術選定の理由

1. **Next.js + React**: 高パフォーマンスなSPA開発と最適なSSRを両立
2. **Supabase**: Firebase同等の機能を提供しながら、より寛容な無料枠と標準的なPostgreSQLの使用
3. **Tailwind + shadcn/ui**: 迅速なUI開発とカスタマイズ性の両立
4. **TypeScript**: 型安全性によるバグの早期発見と開発者体験の向上
5. **Zustand + Tanstack Query**: 軽量かつ効率的な状態管理ソリューション
6. **pnpm**: 依存関係の効率的な管理

## 今後の拡張性

現在の技術スタックは、ユーザー数やデータ量の増加に対応できるように設計されています。将来的には以下の拡張が可能です：

1. **多言語対応**: next-intlを活用した他言語対応
2. **プッシュ通知**: Web Push APIを使用したリマインダー
3. **データエクスポート/インポート**: CSV/PDFエクスポート機能
4. **分析ダッシュボード**: 支出パターンや傾向分析

## 開発環境セットアップ

```bash
# リポジトリのクローン
git clone https://github.com/yourusername/duwallet.git
cd duwallet

# 依存関係のインストール
pnpm install

# 環境変数の設定
cp env_template.txt .env.local
# .env.localを編集してクラウドSupabaseのURLとAPIキーを設定

# 開発サーバーの起動 (Next.jsアプリのみDockerで起動する場合)
docker compose -f docker-compose.dev.yaml up --build

# または pnpm dev で直接起動も可能 (Dockerを使わない場合)
# pnpm dev
```

## 商用利用と運用コスト

現在の技術スタックでは、無料プランの範囲内で十分な機能を提供できます。利用者が増えた場合は、以下の点で段階的にスケーリングが可能です：

1. **Vercelのアップグレード**: Pro ($20/月)へのアップグレードで帯域幅制限の緩和
2. **Supabaseのアップグレード**: Pro ($25/月)プランでデータベース容量とリアルタイム接続数の増加

しかし、通常の家計簿利用のユースケースでは、無料プランの制限内で十分に運用可能です。
