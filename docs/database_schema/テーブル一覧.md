# duwalletデータベースのテーブル一覧

このファイルはduwalletアプリのデータベース定義に関するテーブル一覧を示しています。

## テーブル一覧

| テーブル番号 | テーブル名                   | 説明                                                       | 関連テーブル                                                                |
|------------|----------------------------|----------------------------------------------------------|----------------------------------------------------------------------------|
| D-01       | users                        | ユーザー情報を管理するテーブル                             | wallet_members, wallet_join_requests                                        |
| D-02       | wallets                      | 家計簿の基本情報を管理するテーブル                         | wallet_members, wallet_join_requests, income_expenses, payment_destinations |
| D-03       | wallet_members               | 家計簿とユーザーの関連（メンバーシップ）を管理するテーブル | users, wallets                                                              |
| D-04       | wallet_join_requests         | 家計簿への参加申請を管理するテーブル                       | users, wallets                                                              |
| D-05       | income_expenses              | 収支情報を管理するテーブル                                 | wallets, users                                                              |
| D-06       | payment_destinations         | 支払先を管理するテーブル                                   | wallets                                                                     |
| D-07       | calculation_settings         | 支払額の算出設定を管理するテーブル                         | wallets                                                                     |
| D-08       | payment_rate_adjustments     | ユーザーごとの支払率調整値を管理するサブテーブル           | calculation_settings, users                                                 |

## 各テーブルの概要

### D-01: users

ユーザーの基本情報を管理します。認証情報と個人設定を含みます。

### D-02: wallets

家計簿の基本情報を管理します。名称、参加コード、参加申請受付設定などを含みます。

### D-03: wallet_members

どのユーザーがどの家計簿に属しているか、そのロール（管理者/一般）などの関連情報を管理します。

### D-04: wallet_join_requests

家計簿への参加申請の状態を管理します。申請中、承認済み、却下などの状態を含みます。

### D-05: income_expenses

各家計簿の収支情報を管理します。ユーザー別の収支と共通収支の両方を含み、日付、金額、説明、自動追加設定などの情報を保持します。

### D-06: payment_destinations

支払先の情報を管理します。支払先の名称、支払日（固定日または月末）などを含みます。

### D-07: calculation_settings

支払額の算出方法に関する設定を管理します。算出方法（収入割合方式/残金均一方式）、切上げ桁、収入参照月などの設定を含みます。

### D-08: payment_rate_adjustments

計算方法から自動算出される支払率を調整するための値を保持します。calculation_settingsテーブルのサブテーブルとして機能します。

## ER図

```mermaid
erDiagram
    D-01_users ||--o{ D-03_wallet_members : "参加する"
    D-01_users ||--o{ D-04_wallet_join_requests : "申請する"
    D-01_users ||--o{ D-05_income_expenses : "所有する"
    D-01_users ||--o{ D-08_payment_rate_adjustments : "調整する"
    
    D-02_wallets ||--o{ D-03_wallet_members : "メンバーを持つ"
    D-02_wallets ||--o{ D-04_wallet_join_requests : "申請を受ける"
    D-02_wallets ||--o{ D-05_income_expenses : "収支を持つ"
    D-02_wallets ||--o{ D-06_payment_destinations : "支払先を持つ"
    D-02_wallets ||--|| D-07_calculation_settings : "設定を持つ"
    
    D-07_calculation_settings ||--o{ D-08_payment_rate_adjustments : "調整値を持つ"
    
    D-01_users {
        uuid id PK "ユーザーID"
        varchar email "Eメール"
        varchar password_hash "パスワードハッシュ"
        varchar name "名前"
        varchar gender "性別"
        boolean multiple_wallets "複数家計簿参加設定"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-02_wallets {
        uuid id PK "家計簿ID"
        varchar name "家計簿名"
        boolean accept_join_requests "参加申請受付"
        varchar join_code "参加コード"
        boolean is_join_code_auto "参加コード自動生成"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-03_wallet_members {
        uuid id PK "メンバーシップID"
        uuid user_id FK "ユーザーID（D-01）"
        uuid wallet_id FK "家計簿ID（D-02）"
        varchar role "ロール"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-04_wallet_join_requests {
        uuid id PK "申請ID"
        uuid user_id FK "ユーザーID（D-01）"
        uuid wallet_id FK "家計簿ID（D-02）"
        varchar status "申請状態"
        varchar join_code "使用した参加コード"
        uuid processed_by FK "処理ユーザーID（D-01）"
        timestamp processed_at "処理日時"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-05_income_expenses {
        uuid id PK "収支ID"
        uuid wallet_id FK "家計簿ID（D-02）"
        uuid user_id FK "ユーザーID（D-01）"
        boolean is_common "共通収支フラグ"
        boolean is_income "収入フラグ"
        decimal amount "金額"
        varchar description "説明"
        date transaction_date "収支日"
        varchar year_month "年月"
        boolean auto_add_next "次月以降自動追加"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-06_payment_destinations {
        uuid id PK "支払先ID"
        uuid wallet_id FK "家計簿ID（D-02）"
        varchar name "支払先名称"
        varchar payment_due_type "支払日タイプ"
        integer payment_due_day "支払日（日）"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-07_calculation_settings {
        uuid id PK "設定ID"
        uuid wallet_id FK "家計簿ID（D-02）"
        varchar calculation_method "算出方法"
        varchar reference_month "収入参照月"
        integer rounding_digit "切上げ桁"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
    
    D-08_payment_rate_adjustments {
        uuid id PK "調整値ID"
        uuid calculation_setting_id FK "支払額算出設定ID（D-07）"
        uuid user_id FK "ユーザーID（D-01）"
        decimal adjustment_percentage "調整率（％）"
        timestamp created_at "作成日時"
        timestamp updated_at "更新日時"
    }
```