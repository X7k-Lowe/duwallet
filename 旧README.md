### 概要・仕様

複数ユーザー共通の家計簿（合計月次支払額に対して、参加ユーザー別の月次の収支の割合や手元残金に応じた支払額を自動計算する）webアプリ。メインはモバイルでSPA。iPhoneの「ホーム画面に追加」でアプリ化（PWA）。ターゲットは現在なしで、私たち夫婦が利用する目的で作成。アプリ名の由来はduet（もしくはduo）＋wallet。

### 技術スタック

css：tailwindcss
DB：supabase
他技術スタックは相談。
なるべくサーバー代などのコストがかからないようにする。
また、開発環境はWindowsでMacBookは持っていない。

### レイアウト・デザイン

白黒グレーが基本のシンプルなデザインに、アクセントカラーとして1、2、3色程入れ、シンプルの中にもリッチで美しい、また操作性にも注意を払い、UIUXの高いデザインを目指す。データ読み込み中はスケルトンなどを使用する。

### 基本設計

#### タイトル画面：アプリ名表示、ログイン、ユーザー登録

ログイン：
	Eメール、パスワード、MFA（端末の顔認証か指紋認証）
	ログイン→家計簿選択画面
ユーザー登録：
	ユーザー登録をクリック→ユーザー登録画面

#### ユーザー登録画面：ユーザー情報入力、登録

ユーザー情報項目：
	Eメール、パスワード、名前、性別、複数家計簿に参加するか一つの家計簿のみ参加するかの選択
登録：
	登録をクリック→家計簿選択画面

#### 家計簿選択画面：家計簿選択、家計簿作成、家計簿参加申請（参加コード入力）

※ログインユーザーが家計簿に1つも参加していない、または、複数家計簿に参加するを選んでいる場合のみ表示し、それ以外はスキップ
家計簿選択：
	表示されている家計簿名をクリック→家計簿ホーム画面
家計簿作成：
	家計簿作成をクリック→家計簿作成画面
家計簿参加申請：
	参加コード入力→参加申請クリック→◯件の参加申請中と表示→参加承認待機

#### 家計簿作成画面：基本設定項目入力、作成

基本設定項目：
	家計簿名、家計簿参加申請を受信する/しないの選択、参加コード（自動発行か入力）
作成：
	作成クリック→管理ユーザーロール付与→家計簿ホーム画面

#### 家計簿ホーム画面：表示項目の表示、月移動、収支登録、支払先登録、支払額算出設定、基本設定編集、参加ユーザー管理、ユーザー設定編集

※	作成する月収支情報は今月＋1ヶ月先までデフォルトで作成しておく。月が変わる時に更に次月収入情報を作成する。過去の収支情報も削除しない。
表示項目：
	現在の年月、参加ユーザー名、ユーザー別月次合計収入、ユーザー別月次合計支出、全ユーザー合計月次収入、全ユーザー合計月次支出、ユーザー別月次支払額（支払先に支払日までに支払わなければならない金額、算出方法に依存）、全ユーザー合計月次支払額（支払先に支払日までに支払わなければならない金額、算出方法に依存）、合計金額に対するユーザー別支払率（全員で100%、算出方法に依存）、月次の支払先毎の支払期限
月移動：
	前月、次月をクリックで表示月を更新
収支登録：
	収支登録クリック→月次収支登録画面
支払先登録：
	支払先をクリック→支払先登録画面
支払額算出設定：
	支払額算出クリック→支払額算出設定画面
基本設定編集：
	基本設定クリック→家計簿基本設定画面
参加ユーザー管理：
	参加ユーザークリック→参加ユーザー管理画面
ユーザー設定編集：
	自分のユーザー名（アイコン）をクリック→ユーザー設定画面

#### 月次収支登録画面：入力項目の入力、登録

入力項目：
	ユーザー別月次収入、ユーザー別月次支出、ユーザー共通月次収入、ユーザー共通月次支出
登録：
	登録をクリック→家計簿ホーム画面

#### 支払先登録画面：支払先情報入力、登録

支払先情報：
	名称、月次支払日（4日、27日、月末最終日など）
登録：
	登録をクリック→家計簿ホーム画面

#### 支払額算出設定画面：算出方法選択、ユーザー別支払額表示、ユーザー別支払率表示、支払率編集、切上げ桁編集、収入参照先選択

算出方法：
	ユーザーの収入割合：
		全ユーザー合計月次支払額×ユーザーの収入率
		ユーザーの収入率：
			ユーザー別合計月次収入額÷(全ユーザー合計月次収入額-ユーザー共通合計月次収入額)
	手元残金全ユーザー均一
		ユーザー別合計月次収入額-((全ユーザー合計月次収入額-全ユーザー合計月次支出額)÷参加ユーザー数)
ユーザー別支払額表示：
	選択した算出方法で算出したユーザーごとの月次支払額を表示
ユーザー別支払率表示：
	算出方法：ユーザーの収入割合選択時
		ユーザーの収入率
	算出方法：手元残金全ユーザー均一選択時
		ユーザー別支払額÷全ユーザー合計月次支払額
支払率編集：
	算出方法から算出した支払率をベースの支払率とし、そのベースのユーザー別支払率から(参加ユーザー数-1)%ずつ増減を設定できる
	※1人を(参加ユーザー数-1)%増加させた場合、他のユーザーの支払率を1%減少させる（減少させた場合も同様）
切上げ桁編集：
	支払額の下何桁から切上げるかを数値で指定できる（デフォルト下1桁）

収入参照先選択：前月/今月
	前月が存在しない場合、前月を選べない

#### 基本設定編集画面：基本設定項目入力、登録

基本設定項目：
	家計簿名、家計簿参加申請を受信する/しないの選択、参加コード（自動発行か入力）
登録：
	登録クリック→家計簿ホーム画面

#### 参加ユーザー管理画面：参加ユーザーの表示、申請ユーザーの表示、参加ユーザーのロール選択、申請ユーザーの承認/却下

参加ユーザーの表示：
	参加ユーザーの名前、Eメール、ロールの表示
参加ユーザーのロール選択：
	ロール：
		管理ユーザー、一般ユーザー
	管理ユーザー権限：
		家計簿に申請したユーザーの参加の承認/却下
申請ユーザーの表示：
	申請ユーザーの名前、Eメール、承認ボタン、却下ボタン
	※承認/却下ボタンは管理ユーザーにのみ表示
申請ユーザーの承認/却下：
	承認：
		承認ボタン→参加承認待機の解除→一般ユーザーロール付与→家計簿選択に家計簿名を表示
	却下：
		却下ボタン→参加承認待機の解除

#### ユーザー設定画面：

ユーザー情報項目：
	Eメール、パスワード、名前、性別、複数家計簿に参加するか一つの家計簿のみ参加するかの選択
保存：
	保存をクリック→家計簿ホーム画面

### 実装方針

基本的にAIエージェントに実装タスクをこなしてもらうので、確実に実装を実現できるようプロンプトとして仕様、技術スタック、ディレクトリ構成、DB定義、タスク、テストなどそれぞれ個別にyamlファイルとして作成し、セッション毎に毎回必ずそれらを参照させるようRulesを作し、実装の整合性を取りながらハルシネーションゼロで実装を進める。
タスクに関しては、細かくyamlファイルとして細分化し、直列で実行しなければならないタスク、並列で実行できるタスクに分け、さらにタスクマネージャーyamlで完了・未完了などのステータスを管理する。そしてタスク実行時には必ず仕様等のyaml確実して整合性に注意を払いつつ実装し、実装後はテストを実行して全てのエラーや不具合を解消するところまでをAIエージェントのタスクとする。
